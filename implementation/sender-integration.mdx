---
title: "Sender Integration"
description: "Complete guide to integrating with the Paycrest Protocol as a sender"
---

# Sender Integration Guide

This guide will walk you through integrating with the Paycrest Protocol as a sender, from initial setup to production deployment.

## Prerequisites

Before you begin, ensure you have:

- **Paycrest Account**: Registered and KYC-verified account
- **API Credentials**: API key and secret from your dashboard
- **Development Environment**: Node.js, Python, or your preferred language
- **Test Environment**: Access to sandbox for testing

## Step 1: Account Setup

### 1.1 Register Account

First, create your Paycrest account:

1. Visit [app.paycrest.io](https://app.paycrest.io)
2. Complete the registration process
3. Verify your email address

### 1.2 Complete KYC Verification

KYC verification is required for all senders:

1. **Individual Verification**:
   - Government-issued ID (passport, driver's license)
   - Proof of address
   - Selfie verification

2. **Business Verification** (if applicable):
   - Business registration documents
   - Director identification
   - Business address verification

### 1.3 Generate API Credentials

Once KYC is approved:

1. Navigate to **API Settings** in your dashboard
2. Generate a new API key
3. Save the API key securely
4. Set up IP whitelisting if required

<Note>
  Keep your API key secure and never share it publicly. Consider using environment variables for production deployments.
</Note>

## Step 2: Environment Setup

### 2.1 Choose Your Environment

Paycrest provides two environments:

- **Sandbox**: For testing and development
- **Production**: For live transactions

### 2.2 Configure API Client

#### JavaScript/Node.js

```javascript
// Install the SDK
npm install @paycrest/sdk

// Initialize the client
import { PaycrestClient } from '@paycrest/sdk';

const client = new PaycrestClient({
  apiKey: process.env.PAYCREST_API_KEY,
  environment: process.env.NODE_ENV === 'production' ? 'production' : 'sandbox'
});
```

#### Python

```python
# Install the SDK
pip install paycrest-sdk

# Initialize the client
from paycrest import PaycrestClient

client = PaycrestClient(
    api_key=os.getenv('PAYCREST_API_KEY'),
    environment='production' if os.getenv('NODE_ENV') == 'production' else 'sandbox'
)
```

#### cURL

```bash
# Set your API key
export PAYCREST_API_KEY="your_api_key_here"
export PAYCREST_BASE_URL="https://api.paycrest.io/v1"

# For sandbox
export PAYCREST_BASE_URL="https://sandbox-api.paycrest.io/v1"
```

## Step 3: Create Your First Payment Order

### 3.1 Basic Payment Order

```javascript
// Create a payment order
const order = await client.sender.createOrder({
  amount: '100',
  token: 'USDT',
  network: 'base',
  rate: '1.0',
  recipient: {
    institution: 'GTB',
    accountIdentifier: '1234567890',
    accountName: 'John Doe',
    currency: 'NGN'
  },
  reference: 'payment-123',
  returnAddress: '0x1234567890123456789012345678901234567890',
  feePercent: '0.5',
  feeAddress: '0x1234567890123456789012345678901234567890'
});

console.log('Order created:', order);
```

### 3.2 Handle the Response

```javascript
// The response includes important information
const {
  id,              // Order ID for tracking
  receiveAddress,  // Address to send tokens to
  validUntil,      // Expiration time
  senderFee,       // Fee amount
  transactionFee   // Network transaction fee
} = order;

// Store the order ID for tracking
await saveOrderToDatabase(order.id, order);
```

### 3.3 Send Tokens to Receive Address

```javascript
// Using ethers.js to send tokens
import { ethers } from 'ethers';

const provider = new ethers.providers.JsonRpcProvider('https://mainnet.base.org');
const wallet = new ethers.Wallet(process.env.PRIVATE_KEY, provider);

// USDT contract on Base
const usdtContract = new ethers.Contract(
  '0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb', // USDT on Base
  ['function transfer(address to, uint256 amount) returns (bool)'],
  wallet
);

// Send tokens to the receive address
const tx = await usdtContract.transfer(
  order.receiveAddress,
  ethers.utils.parseUnits(order.amount, 6) // USDT has 6 decimals
);

console.log('Transaction hash:', tx.hash);
```

## Step 4: Monitor Order Status

### 4.1 Poll for Status Updates

```javascript
// Check order status
async function checkOrderStatus(orderId) {
  try {
    const order = await client.sender.getOrder(orderId);
    
    switch (order.status) {
      case 'pending':
        console.log('Order is pending provider assignment');
        break;
      case 'processing':
        console.log('Order is being processed by provider');
        break;
      case 'fulfilled':
        console.log('Order has been fulfilled');
        await handleOrderFulfilled(order);
        break;
      case 'settled':
        console.log('Order has been settled on blockchain');
        await handleOrderSettled(order);
        break;
      case 'cancelled':
        console.log('Order was cancelled:', order.cancellationReason);
        await handleOrderCancelled(order);
        break;
    }
    
    return order;
  } catch (error) {
    console.error('Error checking order status:', error);
    throw error;
  }
}
```

### 4.2 Set Up Webhooks (Recommended)

```javascript
// Set up webhook endpoint
app.post('/webhooks/paycrest', async (req, res) => {
  const { event, orderId, status, data } = req.body;
  
  try {
    switch (event) {
      case 'order.fulfilled':
        await handleOrderFulfilled({ orderId, ...data });
        break;
      case 'order.settled':
        await handleOrderSettled({ orderId, ...data });
        break;
      case 'order.cancelled':
        await handleOrderCancelled({ orderId, ...data });
        break;
    }
    
    res.status(200).json({ status: 'success' });
  } catch (error) {
    console.error('Webhook error:', error);
    res.status(500).json({ status: 'error' });
  }
});

// Register webhook with Paycrest
await client.sender.registerWebhook({
  url: 'https://your-domain.com/webhooks/paycrest',
  events: ['order.fulfilled', 'order.settled', 'order.cancelled']
});
```

## Step 5: Handle Order Lifecycle

### 5.1 Order Fulfilled Handler

```javascript
async function handleOrderFulfilled(order) {
  console.log(`Order ${order.id} has been fulfilled`);
  
  // Update your database
  await updateOrderStatus(order.id, 'fulfilled');
  
  // Notify your user
  await notifyUser(order.userId, {
    type: 'payment_fulfilled',
    orderId: order.id,
    amount: order.amount,
    recipient: order.recipient.accountName
  });
  
  // Log for analytics
  await logAnalytics('order_fulfilled', order);
}
```

### 5.2 Order Settled Handler

```javascript
async function handleOrderSettled(order) {
  console.log(`Order ${order.id} has been settled`);
  
  // Update your database
  await updateOrderStatus(order.id, 'settled');
  
  // Process any post-settlement logic
  await processSettlement(order);
  
  // Update accounting records
  await updateAccounting(order);
}
```

### 5.3 Order Cancelled Handler

```javascript
async function handleOrderCancelled(order) {
  console.log(`Order ${order.id} was cancelled: ${order.cancellationReason}`);
  
  // Update your database
  await updateOrderStatus(order.id, 'cancelled');
  
  // Process refund if necessary
  if (order.amountReturned) {
    await processRefund(order);
  }
  
  // Notify user
  await notifyUser(order.userId, {
    type: 'payment_cancelled',
    orderId: order.id,
    reason: order.cancellationReason
  });
}
```

## Step 6: Error Handling

### 6.1 API Error Handling

```javascript
async function createPaymentOrder(orderData) {
  try {
    const order = await client.sender.createOrder(orderData);
    return order;
  } catch (error) {
    if (error.response?.status === 400) {
      // Validation error
      const validationErrors = error.response.data;
      throw new Error(`Validation failed: ${JSON.stringify(validationErrors)}`);
    } else if (error.response?.status === 401) {
      // Authentication error
      throw new Error('Invalid API key');
    } else if (error.response?.status === 429) {
      // Rate limit exceeded
      throw new Error('Rate limit exceeded. Please try again later.');
    } else {
      // Other errors
      throw new Error(`API error: ${error.message}`);
    }
  }
}
```

### 6.2 Retry Logic

```javascript
async function createOrderWithRetry(orderData, maxRetries = 3) {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await client.sender.createOrder(orderData);
    } catch (error) {
      if (attempt === maxRetries) {
        throw error;
      }
      
      // Wait before retrying (exponential backoff)
      const delay = Math.pow(2, attempt) * 1000;
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}
```

## Step 7: Production Considerations

### 7.1 Security Best Practices

```javascript
// Use environment variables for sensitive data
const config = {
  apiKey: process.env.PAYCREST_API_KEY,
  environment: process.env.NODE_ENV === 'production' ? 'production' : 'sandbox',
  webhookSecret: process.env.PAYCREST_WEBHOOK_SECRET
};

// Validate webhook signatures
app.post('/webhooks/paycrest', async (req, res) => {
  const signature = req.headers['x-paycrest-signature'];
  
  if (!validateWebhookSignature(req.body, signature, config.webhookSecret)) {
    return res.status(401).json({ error: 'Invalid signature' });
  }
  
  // Process webhook
  // ...
});
```

### 7.2 Database Integration

```javascript
// Example with PostgreSQL
const { Pool } = require('pg');

const pool = new Pool({
  connectionString: process.env.DATABASE_URL
});

async function saveOrder(order) {
  const query = `
    INSERT INTO payment_orders (
      id, amount, token, network, status, 
      recipient_institution, recipient_account, recipient_name,
      created_at, updated_at
    ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
  `;
  
  await pool.query(query, [
    order.id,
    order.amount,
    order.token,
    order.network,
    order.status,
    order.recipient.institution,
    order.recipient.accountIdentifier,
    order.recipient.accountName,
    new Date(),
    new Date()
  ]);
}
```

### 7.3 Monitoring and Logging

```javascript
// Set up monitoring
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// Log all API interactions
async function createOrderWithLogging(orderData) {
  logger.info('Creating payment order', { orderData });
  
  try {
    const order = await client.sender.createOrder(orderData);
    logger.info('Payment order created successfully', { orderId: order.id });
    return order;
  } catch (error) {
    logger.error('Failed to create payment order', { error: error.message, orderData });
    throw error;
  }
}
```

## Step 8: Testing

### 8.1 Unit Tests

```javascript
// Using Jest for testing
describe('Paycrest Integration', () => {
  test('should create payment order successfully', async () => {
    const orderData = {
      amount: '100',
      token: 'USDT',
      network: 'base',
      recipient: {
        institution: 'GTB',
        accountIdentifier: '1234567890',
        accountName: 'Test User',
        currency: 'NGN'
      }
    };
    
    const order = await createPaymentOrder(orderData);
    
    expect(order.id).toBeDefined();
    expect(order.receiveAddress).toBeDefined();
    expect(order.status).toBe('pending');
  });
  
  test('should handle API errors gracefully', async () => {
    const invalidOrderData = {
      amount: '-100', // Invalid amount
      token: 'USDT',
      network: 'base'
    };
    
    await expect(createPaymentOrder(invalidOrderData))
      .rejects
      .toThrow('Validation failed');
  });
});
```

### 8.2 Integration Tests

```javascript
// Test the complete flow
describe('Payment Flow', () => {
  test('should complete payment order lifecycle', async () => {
    // 1. Create order
    const order = await createPaymentOrder(testOrderData);
    
    // 2. Send tokens (mock)
    await sendTokensToReceiveAddress(order.receiveAddress, order.amount);
    
    // 3. Wait for fulfillment
    const fulfilledOrder = await waitForOrderFulfillment(order.id);
    
    // 4. Verify settlement
    const settledOrder = await waitForOrderSettlement(order.id);
    
    expect(settledOrder.status).toBe('settled');
  });
});
```

## Step 9: Deployment Checklist

Before going live, ensure you have:

- [ ] **KYC verification completed**
- [ ] **API credentials generated and secured**
- [ ] **Webhook endpoints configured and tested**
- [ ] **Error handling implemented**
- [ ] **Monitoring and logging set up**
- [ ] **Database schema created**
- [ ] **Rate limiting configured**
- [ ] **Security measures implemented**
- [ ] **Testing completed in sandbox**
- [ ] **Documentation updated**

## Support and Resources

### Documentation
- [API Reference](/api-reference/introduction)
- [Protocol Overview](/protocol-overview)
- [Quickstart Guide](/quickstart)

### Community
- **Discord**: [discord.gg/paycrest](https://discord.gg/paycrest)
- **GitHub**: [github.com/paycrest](https://github.com/paycrest)

### Support
- **Email**: [support@paycrest.io](mailto:support@paycrest.io)
- **Documentation Issues**: Create an issue on GitHub

<Note>
  Always test your integration thoroughly in the sandbox environment before deploying to production. The sandbox provides a safe environment to verify your implementation and catch any issues early.
</Note> 